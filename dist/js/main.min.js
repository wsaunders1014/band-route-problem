import{points40,points200,points500}from"./data.js";import*as ga from"./ga.js";var pop=[];console.log(ga);var generatedRoute=!1;const evolveLimit=2e3;var canvas=document.getElementById("canvas");const calcDistance=(e,t,n,o)=>Math.hypot(t-e,o-n);function shuffleArray(e){for(let t=1;t<e.length-1;t++){const n=Math.ceil(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}const createPop=(e,t=20)=>{let n=[];for(let o=0;o<t;o++){let t=e.slice(0);shuffleArray(t),t.push(t[0]),n.push(t)}return n},displayRouteTable=e=>{let t=e;for(let e=0;e<t.length;e++){let n=document.getElementById("routeData").insertRow(-1),o=n.insertCell(0),s=n.insertCell(1);o.innerHTML=`${e+1}`,s.innerHTML=`${t[e].x}, ${t[e].y}`}},displayPoints=e=>{let t=canvas.getContext("2d");t.clearRect(0,0,canvas.width,canvas.height),window.innerWidth<1e3&&e.map((t,n)=>{let o=t.x/1e3,s=t.y/1e3;e[n].x=window.innerWidth*o,e[n].y=window.innerWidth*s}),t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.lineTo(e[0].x,e[0].y),t.stroke(),t.closePath(),t.font="10px Arial";for(let n=0;n<e.length;n++)t.beginPath(),t.arc(e[n].x,e[n].y,10,0,2*Math.PI),t.fillStyle=0!==n?"blue":"red",t.fill(),t.closePath(),t.fillStyle="#fff",n<10?t.fillText(n+1,e[n].x-3,e[n].y+3):n<100&&n>=10?t.fillText(n+1,e[n].x-5,e[n].y+3):t.fillText(n+1,e[n].x-8,e[n].y+3)};window.addEventListener("DOMContentLoaded",()=>{window.innerWidth<1e3&&(canvas.setAttribute("width",window.innerWidth-20),canvas.setAttribute("height",window.innerWidth-20))}),window.addEventListener("resize",()=>{!1!==generatedRoute&&window.innerWidth<1e3?(canvas.setAttribute("width",window.innerWidth-20),canvas.setAttribute("height",window.innerWidth-20),setTimeout(()=>{displayPoints(generatedRoute)},50)):(canvas.setAttribute("width",1e3),canvas.setAttribute("height",1e3))});var buttons=document.getElementsByTagName("button");for(let e=0;e<buttons.length;e++)buttons[e].addEventListener("click",e=>{switch(e.target.getAttribute("id")){case"points40":document.getElementById("loader").style.display="block",pop=createPop(points40);var t={mutationFunction:ga.mutator,crossoverFunction:ga.crossover,fitnessFunction:ga.getFitness,doesABeatBFunction:ga.compareFitness,population:pop};console.log(pop.length);var n=ga.gaConstructor(t);for(let e=0;e<2e3;e++)n.evolve();console.log(n.best(),n.bestScore()),document.getElementById("loader").style.display="none",displayRouteTable(n.best()),displayPoints(n.best()),document.getElementById("distance").innerHTML=`Distance is ${n.bestScore()}`;break;case"points200":pop=createPop(points200);t={mutationFunction:ga.mutator,crossoverFunction:ga.crossover,fitnessFunction:ga.getFitness,doesABeatBFunction:ga.compareFitness,population:pop};console.log(pop.length);n=ga.gaConstructor(t);for(let e=0;e<2e3;e++)n.evolve();console.log(n.best(),n.bestScore()),document.getElementById("loader").style.display="none",displayRouteTable(n.best()),displayPoints(n.best()),document.getElementById("distance").innerHTML=`Distance is ${n.bestScore()}`;break;case"points500":pop=createPop(points500);t={mutationFunction:ga.mutator,crossoverFunction:ga.crossover,fitnessFunction:ga.getFitness,doesABeatBFunction:ga.compareFitness,population:pop};console.log(pop.length);n=ga.gaConstructor(t);for(let e=0;e<2e3;e++)n.evolve();console.log(n.best(),n.bestScore()),document.getElementById("loader").style.display="none",displayRouteTable(n.best()),displayPoints(n.best()),document.getElementById("distance").innerHTML=`Distance is ${n.bestScore()}`}});